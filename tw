#!/usr/bin/env bash
# twsh - a twtxt client written in bash
# (c) 2019 by Anirudh Oppiliappan (@icyphox) <x@icyphox.sh>
#         and Akshay Oppiliappan (@nerdypepper) <nerdypepper@tuta.io>

DATA_DIR="$HOME"

if [[ "$OSTYPE" = "linux-gnu" ]]; then
    DATA_DIR="$HOME/.local/share/twsh"
elif [[ "$OSTYPE" = "darwin" ]]; then
    DATA_DIR="$HOME/Library/ApplicationSupport/com.icyphox.twsh"
fi

TWTXT_FILE="$DATA_DIR/twtxt"

function tweet() {
	text="$1"
	date=$(date -Im)
	tweet="$date\t$text"
	echo -e "$tweet" >> "$TWTXT_FILE"
}

function create_twtxt() {
    mkdir -p "$DATA_DIR"
    twtxt="$DATA_DIR/twtxt"

	if [ -f "$twtxt" ]
	then
		read -p "twsh: $twtxt exists, overwrite? [y/n]: " yn
		case $yn in
			[Yy]* ) rm "$twtxt" && touch "$1";;
			[Nn]* ) exit;;
			* ) echo "twsh: enter yes or no"
		esac
	else
		touch "$twtxt"
		echo "twsh: created $twtxt"
	fi
}

function help_text () {
cat << EOF
Usage: twsh [options]
EOF
}

while getopts :iht: options
do
    case $options in
        i) 
            # init
            create_twtxt
            ;;
        t)
            # tweet
            tweet "$OPTARG"
            ;;
        h|?)
            help_text
            ;;
    esac
done
